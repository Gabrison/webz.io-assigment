pipeline {
    agent any
    environment {
        FLOATING_IP = "172.28.1.100"
        LOG_FILE = "/var/log/webz/active_node_ssh_log.txt"
    }
    stages {
        stage('Get Active Node via SSH') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'cluster-ssh', usernameVariable: 'SSH_USER', passwordVariable: 'SSH_PASS')]) {
                    script {
                        // SSH to the floating IP and get the hostname
                        def hostname = sh(
                            script: 'sshpass -p "$SSH_PASS" ssh -o StrictHostKeyChecking=no $SSH_USER@$FLOATING_IP "hostname"',
                            returnStdout: true
                        ).trim()
                        // Log the result with timestamp
                        sh 'echo "$(date) - ' + hostname + '" >> $LOG_FILE'
                        // Show the log in Jenkins output
                        sh 'cat $LOG_FILE'
                    }
                }
            }
        }
    }
}